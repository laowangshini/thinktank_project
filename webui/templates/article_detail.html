<!-- webui/templates/article_detail.html -->
{% extends "base.html" %}
{% load static %} <!-- 如果模板中有用到静态文件 -->

{% block title %}{{ article.title }} - 智库内容管理系统{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- 文章内容 -->
        <article class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h1 class="h4 mb-2">{{ article.title }}</h1>
                        <div class="text-muted">
                            <!-- 修改点1: url_for -> url -->
                            <a href="{% url 'webui:thinktank_detail' thinktank_id=article.thinktank.id %}" class="text-decoration-none">
                                <i class="fas fa-building me-1"></i>{{ article.thinktank.name }}
                            </a>
                            {% if article.content_type %}
                                <span class="mx-2">|</span>
                                <i class="fas fa-tag me-1"></i>{{ article.content_type }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-end">
                        {% if article.digest %}
                            <span class="badge bg-success mb-2">已摘编</span>
                        {% else %}
                            <span class="badge bg-warning mb-2">待摘编</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="card-body">
                <!-- 文章信息 -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        {% if article.author %}
                            <div class="mb-1">
                                <i class="fas fa-user me-2 text-muted"></i>
                                <strong>作者:</strong> {{ article.author }}
                            </div>
                        {% endif %}
                        {% if article.publish_date %}
                            <div class="mb-1">
                                <i class="fas fa-calendar me-2 text-muted"></i>
                                <strong>发布日期:</strong>
                                <!-- 修改点2: strftime -> date 过滤器 -->
                                {{ article.publish_date|date:"Y年m月d日" }}
                            </div>
                        {% endif %}
                        <div class="mb-1">
                            <i class="fas fa-clock me-2 text-muted"></i>
                            <strong>爬取时间:</strong>
                            <!-- 修改点2: strftime -> date 过滤器 -->
                            {{ article.crawl_date|date:"Y-m-d H:i:s" }}
                        </div>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <div class="mb-1">
                            <i class="fas fa-eye me-2 text-muted"></i>
                            <strong>浏览次数:</strong> {{ article.view_count|default:0 }}
                        </div>
                        {% if article.tags %}
                            <div class="mb-1">
                                <i class="fas fa-tags me-2 text-muted"></i>
                                <strong>标签:</strong>
                                <!-- 修改点3: 处理 tags -->
                                <!-- 假设 article.tags 是一个可以直接显示的字符串，或者你在视图中把它处理成了 tags_list -->
                                <!-- 如果是逗号分隔的字符串，简单显示: -->
                                 {{ article.tags }}
                                <!-- 如果你在视图中传了 tags_list: -->
                                <!--
                                {% for tag in tags_list %} 
                                    <span class="badge bg-secondary me-1">{{ tag.strip }}</span>
                                {% endfor %}
                                -->
                                <!-- 如果必须在模板中分割字符串 (不推荐)，需要自定义过滤器 -->
                            </div>
                        {% endif %}
                    </div>
                </div>

                <hr>

                <!-- 文章摘要 -->
                {% if article.summary %}
                    <div class="mb-4">
                        <h5><i class="fas fa-quote-left me-2"></i>摘要</h5>
                        <div class="bg-light p-3 rounded">
                            {{ article.summary }}
                        </div>
                    </div>
                {% endif %}

                <!-- 文章内容 -->
                {% if article.content %}
                    <div class="mb-4">
                        <h5><i class="fas fa-file-text me-2"></i>正文</h5>
                        <div class="content">
                            <!-- 修改点4: |safe 过滤器在 Django 中也叫 |safe -->
                            {{ article.content|safe }}
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        暂无正文内容，请访问原文链接查看完整内容。
                    </div>
                {% endif %}

                <!-- 原文链接 -->
                <div class="mt-4 pt-3 border-top">
                    <a href="{{ article.url }}" target="_blank" class="btn btn-outline-primary">
                        <i class="fas fa-external-link-alt me-2"></i>查看原文
                    </a>
                </div>
            </div>
        </article>
    </div>

    <div class="col-lg-4">
        <!-- 操作面板 -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-tools me-2"></i>操作</h5>
            </div>
            <div class="card-body">
                {% if article.digest %}
                    <!-- 修改点5: url_for -> url -->
                    <a href="{% url 'webui:digest_detail' article_id=article.id %}" class="btn btn-success btn-block mb-2 w-100">
                        <i class="fas fa-eye me-2"></i>查看摘编
                    </a>
                    <!-- 修改点5: url_for -> url -->
                    <a href="{% url 'webui:digest_edit' article_id=article.id %}" class="btn btn-outline-warning btn-block mb-2 w-100">
                        <i class="fas fa-edit me-2"></i>编辑摘编
                    </a>
                {% else %}
                    <!-- 修改点5: url_for -> url -->
                    <a href="{% url 'webui:digest_edit' article_id=article.id %}" class="btn btn-warning btn-block mb-2 w-100">
                        <i class="fas fa-plus me-2"></i>创建摘编
                    </a>
                {% endif %}

                <a href="{{ article.url }}" target="_blank" class="btn btn-outline-primary btn-block w-100">
                    <i class="fas fa-external-link-alt me-2"></i>访问原文
                </a>
            </div>
        </div>

        <!-- 智库信息 -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-building me-2"></i>智库信息</h5>
            </div>
            <div class="card-body">
                <h6>{{ article.thinktank.name }}</h6>
                {% if article.thinktank.description %}
                    <p class="text-muted small">{{ article.thinktank.description }}</p>
                {% endif %}
                <!-- 修改点6: url_for -> url -->
                <a href="{% url 'webui:thinktank_detail' thinktank_id=article.thinktank.id %}" class="btn btn-outline-info btn-sm">
                    <i class="fas fa-info-circle me-1"></i>查看详情
                </a>
            </div>
        </div>

        <!-- 相关文章 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-list me-2"></i>相关文章</h5>
            </div>
            <div class="card-body">
                <p class="text-muted small">功能开发中...</p>
            </div>
        </div>
    </div>
</div>

<!-- 返回按钮 -->
<div class="mt-4">
    <!-- 修改点7: url_for -> url -->
    <a href="{% url 'webui:articles' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>返回文章列表
    </a>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* CSS 部分保持不变 */
.content {
    line-height: 1.8;
    font-size: 16px;
}

.content p {
    margin-bottom: 1rem;
}

.content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    font-weight: 600;
}

.content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.375rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.content blockquote {
    border-left: 4px solid #007bff;
    background-color: #f8f9fa;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 0.375rem;
}

.content code {
    background-color: #f8f9fa;
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
}

.content pre {
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 0.375rem;
    overflow-x: auto;
}
</style>
{% endblock %}